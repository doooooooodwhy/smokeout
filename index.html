<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Smokeout</title>
  <style>
    body{font-family:system-ui;background:#111;color:#eee;margin:0;display:flex;flex-direction:column;height:100vh}
    #top{display:flex;justify-content:space-between;padding:8px}
    #arena{flex:1;display:flex;justify-content:space-around;align-items:center}
    .side{width:45%;height:80%;border:2px solid #555;border-radius:8px;padding:8px}
    #chatbar{display:flex;padding:8px;background:#222}
    #chatbar input{flex:1;margin-right:8px}
    #shop{display:flex;gap:4px;flex-wrap:wrap;padding:8px;background:#333}
    .powerup{background:#444;border:1px solid #666;padding:4px 8px;border-radius:4px;cursor:pointer}
  </style>
</head>
<body>
  <div id="top">
    <span>Roastbucks: <b id="bucks">0</b></span>
    <span id="timer">1:30</span>
    <span id="stage">Stage 1</span>
  </div>

  <div id="arena">
    <div class="side" id="left"><h3>Player 1</h3><ul id="leftChat"></ul></div>
    <div class="side" id="right"><h3>Player 2</h3><ul id="rightChat"></ul></div>
  </div>

  <div id="shop"></div>

  <div id="chatbar">
    <input id="msg" placeholder="Type your roastâ€¦" autocomplete="off"/>
    <button id="send">Send</button>
  </div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const room = urlParams.get("room") || "default";
const ws = new WebSocket(`wss://${location.hostname}/ws/${room}`);

let myName = "", myRole = "";
const powerups = ["extra_burn","mic_drop","taxes","reverse_roast","silent_mode","judges_favor","savage_mode"];
const prices = {extra_burn:50,mic_drop:30,taxes:120,reverse_roast:45,silent_mode:10,judges_favor:50,savage_mode:750};

ws.onopen = () => {
  myName = prompt("Enter nickname:");
  myRole = confirm("Click OK to be a PLAYER, Cancel to be a JUDGE") ? "player" : "judge";
  ws.send(JSON.stringify({type:"join",name:myName,role:myRole}));
};

ws.onmessage = (ev) => {
  const m = JSON.parse(ev.data);
  if(m.type==="chat"){
    const side = document.getElementById(m.side||"leftChat");
    const li = document.createElement("li");
    li.textContent = `${m.from}: ${m.text}`;
    side.appendChild(li);
  }
  if(m.type==="bucks"){
    document.getElementById("bucks").textContent = m.value;
  }
  if(m.type==="new_match"){
    document.getElementById("leftChat").innerHTML="";
    document.getElementById("rightChat").innerHTML="";
  }
};

document.getElementById("send").onclick = () => {
  const txt = document.getElementById("msg").value.trim();
  if(!txt) return;
  ws.send(JSON.stringify({type:"chat",text:txt}));
  document.getElementById("msg").value="";
};

// quick shop
const shop = document.getElementById("shop");
powerups.forEach(pu=>{
  const b = document.createElement("button");
  b.className="powerup";
  b.textContent = `${pu} (${prices[pu]})`;
  b.onclick = () => ws.send(JSON.stringify({type:"buy_powerup",powerup:pu}));
  shop.appendChild(b);
});
</script>
</body>
</html>
